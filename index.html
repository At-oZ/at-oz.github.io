<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>瞬間英作文アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'BIZ UDPGothic', Meiryo, sans-serif;
        }
        .answer {
            transition: all 0.3s ease-in-out;
        }
        #sidebar {
            transition: transform 0.3s ease-in-out;
        }
        /* 音声読み上げ非対応ブラウザ用のスタイル */
        .no-speech .speak-button {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 overflow-x-hidden">

    <div id="app" class="relative min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <button id="menu-button" class="p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="header-title" class="text-xl font-bold text-gray-800 truncate px-2">
                        瞬間英作文アプリ
                    </div>
                    <div class="w-8"></div> <!-- Spacer -->
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <div id="sidebar-container" class="fixed inset-0 z-30 pointer-events-none">
             <!-- Overlay -->
            <div id="sidebar-overlay" class="absolute inset-0 bg-black bg-opacity-50 opacity-0 transition-opacity duration-300"></div>

            <aside id="sidebar" class="absolute top-0 left-0 h-full w-64 bg-white shadow-xl transform -translate-x-full pointer-events-auto">
                <div class="p-4">
                    <h2 class="text-lg font-semibold text-gray-800">メニュー</h2>
                </div>
                <nav id="sidebar-nav" class="mt-4">
                    <!-- Nav items will be inserted here -->
                </nav>
            </aside>
        </div>

        <!-- Main Content -->
        <main id="main-content" class="max-w-4xl mx-auto p-4 md:p-8">
            <!-- Page content will be inserted here -->
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
             // ブラウザが音声合成APIに対応しているかチェック
            if (!('speechSynthesis' in window)) {
                document.body.classList.add('no-speech');
            }

            // --- State Management ---
            let pages = [];
            let currentPageId = null;

            // --- DOM Elements ---
            const mainContent = document.getElementById('main-content');
            const sidebarNav = document.getElementById('sidebar-nav');
            const menuButton = document.getElementById('menu-button');
            const sidebarContainer = document.getElementById('sidebar-container');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const headerTitle = document.getElementById('header-title');

            // --- Data Loading ---
            const loadInitialData = async () => {
                try {
                    // manifest.jsonを読み込み、章のファイルリストを取得
                    const manifestResponse = await fetch('manifest.json');
                    if (!manifestResponse.ok) {
                        throw new Error(`manifest.jsonの読み込みに失敗しました (${manifestResponse.status})`);
                    }
                    const manifest = await manifestResponse.json();
                    const chapterFiles = manifest.chapters;

                    // 各章のJSONファイルを並行して読み込む
                    const chapterPromises = chapterFiles.map(file =>
                        fetch(file).then(res => {
                            if (!res.ok) {
                                throw new Error(`${file}の読み込みに失敗しました (${res.status})`);
                            }
                            return res.json();
                        })
                    );
                    const allChapters = await Promise.all(chapterPromises);

                    // ページデータを構築
                    pages = allChapters.map((data, index) => ({
                        id: chapterFiles[index].replace('.json', ''),
                        title: data.章タイトル,
                        data: data
                    }));
                    
                    if (pages.length > 0) {
                        currentPageId = pages[0].id;
                        renderPage(currentPageId);
                    } else {
                         mainContent.innerHTML = `<p class="text-center text-gray-500">学習データが見つかりませんでした。manifest.jsonを確認してください。</p>`;
                    }

                } catch (error) {
                    console.error("学習データの読み込みエラー:", error);
                    mainContent.innerHTML = `<div class="text-center text-red-600 bg-red-100 p-4 rounded-lg"><p class="font-bold">データの読み込みに失敗しました。</p><p class="text-sm mt-2">manifest.jsonや各章のJSONファイルが正しく配置されているか、またファイル内に文法エラーがないか確認してください。</p><p class="text-xs mt-1 text-gray-500">${error.message}</p></div>`;
                }
                 renderSidebar(); // 常にサイドバーは表示する
            };

            // --- Sidebar Toggle ---
            const toggleSidebar = () => {
                const isOpen = !sidebar.classList.contains('-translate-x-full');
                if (isOpen) {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('opacity-0');
                    sidebarContainer.classList.add('pointer-events-none');
                } else {
                    sidebar.classList.remove('-translate-x-full');
                    sidebarOverlay.classList.remove('opacity-0');
                    sidebarContainer.classList.remove('pointer-events-none');
                }
            };
            menuButton.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);

            // --- Rendering Functions ---
            const renderSidebar = () => {
                let navHtml = '<ul>';
                pages.forEach(page => {
                    const isActive = page.id === currentPageId;
                    navHtml += `
                        <li>
                            <a href="#" data-page-id="${page.id}" class="page-link block px-4 py-2 text-sm ${isActive ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'text-gray-600 hover:bg-gray-100'}">
                                ${page.title}
                            </a>
                        </li>
                    `;
                });
                navHtml += '</ul>';
                sidebarNav.innerHTML = navHtml;
            };

            const renderPage = (pageId) => {
                currentPageId = pageId;
                const page = pages.find(p => p.id === pageId);
                if (!page) return;
                
                headerTitle.textContent = page.title;
                renderChapterPage(page.data);
                renderSidebar();
                window.scrollTo(0, 0);
            };

            const renderChapterPage = (chapterData) => {
                let contentHtml = '';
                contentHtml += `<header class="mb-12 text-center"><h1 class="text-4xl font-bold text-gray-900 mb-4">${chapterData.章タイトル}</h1><p class="text-lg text-gray-600">${chapterData.章の説明}</p></header>`;
                chapterData.セクション.forEach((section, sectionIndex) => {
                    contentHtml += `<section class="mb-12"><div class="mb-8"><h2 class="text-2xl font-semibold text-gray-900 border-b-2 border-indigo-500 pb-2 mb-3">${section.セクションタイトル}</h2><p class="text-md text-gray-600">${section.セクションの説明}</p></div>`;
                    section.例文.forEach((example, exampleIndex) => {
                        const uniqueId = `ex-${currentPageId}-${sectionIndex}-${exampleIndex}`;
                        const safeEnglishText = JSON.stringify(example.英語); // onclick属性のためにテキストを安全にエンコード
                        contentHtml += `
                        <div class="bg-white rounded-lg shadow-md mb-6 p-6">
                            <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4">
                                <p class="text-lg flex-grow sm:pr-4 mb-4 sm:mb-0">${example.日本語}</p>
                                <button onclick="toggleAnswer('${uniqueId}')" class="w-full sm:w-auto flex-shrink-0 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors duration-300">
                                    英文表示
                                </button>
                            </div>
                            <div id="${uniqueId}" class="answer hidden pt-4 border-t border-gray-200">
                                <div class="flex items-center justify-between gap-4 mb-2">
                                    <p class="text-lg text-indigo-700 font-semibold flex-grow">${example.英語}</p>
                                    <button onclick='speakText(${safeEnglishText})' class="speak-button flex-shrink-0 p-2 rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors" aria-label="英文を読み上げる">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                                    </button>
                                </div>
                                <p class="text-sm text-gray-600 bg-gray-100 p-3 rounded-md"><strong class="font-semibold">ポイント：</strong>${example.ポイント}</p>
                            </div>
                        </div>`;
                    });
                    contentHtml += `</section>`;
                });
                mainContent.innerHTML = contentHtml;
            };

            sidebarNav.addEventListener('click', (e) => {
                if (e.target.matches('.page-link')) {
                    e.preventDefault();
                    const pageId = e.target.dataset.pageId;
                    renderPage(pageId);
                    toggleSidebar();
                }
            });

            // --- Initial Load ---
            loadInitialData();
        });

        // --- Global Functions ---
        function speakText(text) {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function toggleAnswer(id) {
            const answerEl = document.getElementById(id);
            const button = answerEl.previousElementSibling.querySelector('button');
            if (answerEl.classList.contains('hidden')) {
                answerEl.classList.remove('hidden');
                button.textContent = '閉じる';
                button.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                button.classList.add('bg-gray-500', 'hover:bg-gray-600');
            } else {
                answerEl.classList.add('hidden');
                button.textContent = '英文表示';
                button.classList.remove('bg-gray-500', 'hover:bg-gray-600');
                button.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            }
        }
    </script>

</body>
</html>

